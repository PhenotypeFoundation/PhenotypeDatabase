/*!
 * jQuery UI Timepicker 0.2.1
 *
 * Copyright (c) 2009 Martin Milesich (http://milesich.com/)
 *
 * Some parts are
 *   Copyright (c) 2009 AUTHORS.txt (http://jqueryui.com/about)
 *
 * $Id: timepicker.js 28 2009-08-11 20:31:23Z majlo $
 *
 * Depends:
 *  ui.core.js
 *  ui.datepicker.js
 *  ui.slider.js
 */
(function(b){b.extend(b.datepicker._defaults,{stepMinutes:1,stepHours:1,time24h:false,showTime:false,altTimeField:""});b.datepicker._connectDatepickerOverride=b.datepicker._connectDatepicker;b.datepicker._connectDatepicker=function(e,d){b.datepicker._connectDatepickerOverride(e,d);if(this._get(d,"showTime")){d.settings.showButtonPanel=true}var c=this._get(d,"showOn");if(c=="button"||c=="both"){d.trigger.unbind("click");d.trigger.click(function(){if(b.datepicker._datepickerShowing&&b.datepicker._lastInput==e){b.datepicker._hideDatepicker(null)}else{b.datepicker._showDatepicker(e)}return false})}};b.datepicker._showDatepickerOverride=b.datepicker._showDatepicker;b.datepicker._showDatepicker=function(d){b.datepicker._showDatepickerOverride(d);d=d.target||d;if(d.nodeName.toLowerCase()!="input"){d=b("input",d.parentNode)[0]}if(b.datepicker._isDisabledDatepicker(d)){return}var e=b.datepicker._getInst(d);var c=b.datepicker._get(e,"showTime");if(c){b.timepicker.show(d)}};b.datepicker._checkExternalClickOverride=b.datepicker._checkExternalClick;b.datepicker._checkExternalClick=function(d){if(!b.datepicker._curInst){return}var c=b(d.target);if((c.parents("#"+b.timepicker._mainDivId).length==0)){b.datepicker._checkExternalClickOverride(d)}};b.datepicker._hideDatepickerOverride=b.datepicker._hideDatepicker;b.datepicker._hideDatepicker=function(d,f){var e=this._curInst;if(!e||(d&&e!=b.data(d,PROP_NAME))){return}var c=this._get(e,"showTime");if(d===undefined&&c){if(e.input){e.input.val(this._formatDate(e));e.input.trigger("change")}this._updateAlternate(e);if(c){b.timepicker.update(this._formatDate(e))}}b.datepicker._hideDatepickerOverride(d,f);if(c){b.timepicker.hide()}};b.datepicker._selectDate=function(h,d){var g=b(h);var f=this._getInst(g[0]);var c=this._get(f,"showTime");d=(d!=null?d:this._formatDate(f));if(!c){if(f.input){f.input.val(d)}this._updateAlternate(f)}var e=this._get(f,"onSelect");if(e){e.apply((f.input?f.input[0]:null),[d,f])}else{if(f.input&&!c){f.input.trigger("change")}}if(f.inline){this._updateDatepicker(f)}else{if(!f.stayOpen){if(c){this._updateDatepicker(f)}else{this._hideDatepicker(null,this._get(f,"duration"));this._lastInput=f.input[0];if(typeof(f.input[0])!="object"){f.input[0].focus()}this._lastInput=null}}}};b.datepicker._updateDatepickerOverride=b.datepicker._updateDatepicker;b.datepicker._updateDatepicker=function(c){b.datepicker._updateDatepickerOverride(c);b.timepicker.resize()};function a(){}a.prototype={init:function(){this._mainDivId="ui-timepicker-div";this._inputId=null;this._orgValue=null;this._orgHour=null;this._orgMinute=null;this._colonPos=-1;this._visible=false;this.tpDiv=b('<div id="'+this._mainDivId+'" class="ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all ui-helper-hidden-accessible" style="width: 100px; display: none; position: absolute;"></div>');this._generateHtml()},show:function(j){var e=b.datepicker._getInst(j);this._time24h=b.datepicker._get(e,"time24h");this._altTimeField=b.datepicker._get(e,"altTimeField");var c=parseInt(b.datepicker._get(e,"stepMinutes"),10)||1;var i=parseInt(b.datepicker._get(e,"stepHours"),10)||1;if(60%c!=0){c=1}if(24%i!=0){i=1}b("#hourSlider").slider("option","max",24-i);b("#hourSlider").slider("option","step",i);b("#minuteSlider").slider("option","max",60-c);b("#minuteSlider").slider("option","step",c);this._inputId=j.id;if(!this._visible){this._parseTime();this._orgValue=b("#"+this._inputId).val()}var h=this;b("#"+this._mainDivId).show("slow",function(){h.resize()});this._visible=true;var d=b("#"+b.datepicker._mainDivId);var g=d.position();var f=(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)+b(document).scrollLeft();var k=this.tpDiv.offset().left+this.tpDiv.outerWidth();if(k>f){d.css("left",g.left-(k-f)-5);this.tpDiv.css("left",d.offset().left+d.outerWidth()+"px")}},update:function(d){var e=b("#"+this._mainDivId+" span.fragHours").text()+":"+b("#"+this._mainDivId+" span.fragMinutes").text();if(!this._time24h){e+=" "+b("#"+this._mainDivId+" span.fragAmpm").text()}var c=b("#"+this._inputId).val();b("#"+this._inputId).val(d+" "+e);if(this._altTimeField){b(this._altTimeField).each(function(){b(this).val(e)})}},hide:function(){this._visible=false;b("#"+this._mainDivId).hide()},resize:function(){var d=b("#"+b.datepicker._mainDivId);var e=d.position();var c=b("#"+b.datepicker._mainDivId+" > div.ui-datepicker-header:first-child").height();b("#"+this._mainDivId+" > div.ui-datepicker-header:first-child").css("height",c);this.tpDiv.css({height:d.height(),top:e.top,left:e.left+d.outerWidth()+"px"});b("#hourSlider").css("height",this.tpDiv.height()-(3.5*c));b("#minuteSlider").css("height",this.tpDiv.height()-(3.5*c))},_generateHtml:function(){var d="";d+='<div class="ui-datepicker-header ui-widget-header ui-helper-clearfix ui-corner-all">';d+='<div class="ui-datepicker-title" style="margin:0">';d+='<span class="fragHours">08</span><span class="delim">:</span><span class="fragMinutes">45</span> <span class="fragAmpm"></span></div></div><table>';d+="<tr><th>Hour</th><th>Minute</th></tr>";d+='<tr><td align="center"><div id="hourSlider" class="slider"></div></td><td align="center"><div id="minuteSlider" class="slider"></div></td></tr>';d+="</table>";this.tpDiv.empty().append(d);b("body").append(this.tpDiv);var c=this;b("#hourSlider").slider({orientation:"vertical",range:"min",min:0,max:23,step:1,slide:function(e,f){c._writeTime("hour",f.value)},stop:function(e,f){b("#"+c._inputId).focus()}});b("#minuteSlider").slider({orientation:"vertical",range:"min",min:0,max:59,step:1,slide:function(e,f){c._writeTime("minute",f.value)},stop:function(e,f){b("#"+c._inputId).focus()}});b("#hourSlider > a").css("padding",0);b("#minuteSlider > a").css("padding",0)},_writeTime:function(c,d){if(c=="hour"){if(!this._time24h){if(d<12){b("#"+this._mainDivId+" span.fragAmpm").text("am")}else{b("#"+this._mainDivId+" span.fragAmpm").text("pm");d-=12}if(d==0){d=12}}else{b("#"+this._mainDivId+" span.fragAmpm").text("")}if(d<10){d="0"+d}b("#"+this._mainDivId+" span.fragHours").text(d)}if(c=="minute"){if(d<10){d="0"+d}b("#"+this._mainDivId+" span.fragMinutes").text(d)}},_parseTime:function(){var f=b("#"+this._inputId).val();this._colonPos=f.search(":");var c=0,e=0,d="";if(this._colonPos!=-1){e=parseInt(f.substr(this._colonPos-2,2),10);c=parseInt(f.substr(this._colonPos+1,2),10);d=jQuery.trim(f.substr(this._colonPos+3,3))}d=d.toLowerCase();if(d!="am"&&d!="pm"){d=""}if(e<0){e=0}if(c<0){c=0}if(e>23){e=23}if(c>59){c=59}if(d=="pm"&&e<12){e+=12}if(d=="am"&&e==12){e=0}this._setTime("hour",e);this._setTime("minute",c);this._orgHour=e;this._orgMinute=c},_setTime:function(c,d){if(isNaN(d)){d=0}if(d<0){d=0}if(d>23&&c=="hour"){d=23}if(d>59&&c=="minute"){d=59}if(c=="hour"){b("#hourSlider").slider("value",d)}if(c=="minute"){b("#minuteSlider").slider("value",d)}this._writeTime(c,d)}};b.timepicker=new a();b("document").ready(function(){b.timepicker.init()})})(jQuery);